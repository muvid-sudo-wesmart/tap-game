<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–¢–∞–ø–∞–π –∑–∞ –ö–∞–ª–∞—à–Ω–∏–∫–æ–≤–∞</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: Arial, sans-serif; background: #f0f8ff; }

    #loader {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: #000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    #loader img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      position: absolute;
      z-index: -1;
    }

    .loader-progress {
      position: absolute;
      bottom: 20px;
      width: 80%;
      height: 10px;
      background-color: rgba(255, 255, 255, 0.5);
      border-radius: 5px;
      overflow: hidden;
    }

    .loader-progress-bar {
      height: 100%;
      width: 0%;
      background-color: #4caf50;
      transition: width 1s linear;
    }

    header { background: #4caf50; padding: 20px; color: white; text-align: center; }

    section { display: none; padding: 20px; text-align: center; }
    section.active { display: block; }

    #tap-image {
      width: 150px;
      cursor: pointer;
      transition: transform 0.1s ease;
    }

    #tap-image:active {
      transform: scale(1.1);
    }

    nav {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: #4caf50;
      display: flex;
      justify-content: space-around;
      z-index: 1000;
    }

    nav button {
      flex: 1;
      padding: 15px 0;
      background: none;
      color: white;
      border: none;
      font-size: 16px;
      cursor: pointer;
    }

    ul { list-style: none; padding: 0; max-width: 600px; margin: auto; }

    .task-card {
      background: #fff;
      margin: 10px;
      padding: 10px;
      border-radius: 8px;
      transition: 0.3s;
    }

    .task-card:hover {
      transform: scale(1.02);
    }

    .done { color: green; }
  </style>
</head>
<body>
  <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
  <div id="loader">
    <img src="https://raw.githubusercontent.com/muvid-sudo-wesmart/tap-game/main/Frame_159-3.png" alt="–ó–∞–≥—Ä—É–∑–∫–∞">
    <div class="loader-progress"><div class="loader-progress-bar"></div></div>
    <p style="color: white;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
  </div>

  <header><h1>–¢–∞–ø–∞–π –∑–∞ –ö–∞–ª–∞—à–Ω–∏–∫–æ–≤–∞!</h1></header>

  <!-- –í–∫–ª–∞–¥–∫–∏ -->
  <nav>
    <button onclick="showTab('game')">–ò–≥—Ä–∞</button>
    <button onclick="showTab('tasks')">–ó–∞–¥–∞–Ω–∏—è</button>
    <button onclick="showTab('friends')">–î—Ä—É–∑—å—è</button>
    <button onclick="showTab('stats')">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
    <button onclick="showTab('achievements')">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</button>
  </nav>

  <!-- –ò–≥—Ä–∞ -->
  <section id="game" class="active">
    <h2>–ù–∞–∂–º–∏ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É!</h2>
    <p>–¢–∞–ø–æ–≤: <span id="counter">0</span></p>
    <p>–†–µ–∫–æ—Ä–¥: <span id="best">0</span></p>
    <p>–£—Ä–æ–≤–µ–Ω—å: <span id="level">1</span></p>
    <progress id="progress" value="0" max="100"></progress><br><br>
    <img id="tap-image" src="https://raw.githubusercontent.com/muvid-sudo-wesmart/tap-game/main/tap.png" onclick="tap()" />
  </section>

  <!-- –ó–∞–¥–∞–Ω–∏—è -->
  <section id="tasks">
    <h2>üéØ –ó–∞–¥–∞–Ω–∏—è</h2>
    <ul id="task-list"></ul>
  </section>

  <!-- –î—Ä—É–∑—å—è -->
  <section id="friends">
    <h2>üë• –î—Ä—É–∑—å—è</h2>
    <form onsubmit="addFriend(event)">
      <input type="text" id="friend-name" placeholder="–ò–º—è –¥—Ä—É–≥–∞" required />
      <input type="number" id="friend-taps" placeholder="–¢–∞–ø–æ–≤" required />
      <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
    </form>
    <table style="width: 100%; margin-top: 10px;">
      <thead><tr><th>#</th><th>–ò–º—è</th><th>–¢–∞–ø—ã</th></tr></thead>
      <tbody id="friends-table"></tbody>
    </table>
  </section>

  <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
  <section id="stats">
    <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
    <p>–í—Å–µ–≥–æ —Ç–∞–ø–æ–≤: <span id="stat-total">0</span></p>
    <p>–†–µ–∫–æ—Ä–¥: <span id="stat-best">0</span></p>
  </section>

  <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è -->
  <section id="achievements">
    <h2>üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>
    <p>–£—Ä–æ–≤–µ–Ω—å: <span id="achieve-level">1</span></p>
    <p>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥—Ä—É–∑–µ–π: <span id="achieve-friends">0</span></p>
  </section>

  <script>
    // Telegram init
    const tg = window.Telegram.WebApp;
    tg.expand();

    // –ó–∞–≥—Ä—É–∑–∫–∞
    window.addEventListener('load', () => {
      let p = 0;
      const loader = document.querySelector('#loader');
      const bar = document.querySelector('.loader-progress-bar');
      const interval = setInterval(() => {
        p += 10;
        bar.style.width = p + '%';
        if (p >= 100) {
          clearInterval(interval);
          setTimeout(() => loader.style.display = 'none', 500);
        }
      }, 100);
    });

    let count = parseInt(localStorage.getItem('count')) || 0;
    let best = parseInt(localStorage.getItem('best')) || 0;
    let level = 1;
    const thresholds = [100, 500, 2000, 5000, 10000];

    const tasks = [
      { id: 't1', text: '–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ Telegram', reward: 300, link: 'https://t.me/volonteri_kalashnikova' },
      { id: 't2', text: '–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ VK', reward: 300, link: 'https://m.vk.com/id803959232' },
      { id: 't3', text: '–ü–æ—Å–µ—Ç–∏—Ç—å —Å–∞–π—Ç', reward: 200, link: 'https://example.com' },
      { id: 't4', text: '–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∏–¥–µ–æ', reward: 400, link: 'https://youtu.be/yourvideo' },
      { id: 't5', text: '–ü—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞—Ç—å 14 —Å–µ–Ω—Ç—è–±—Ä—è', reward: 500 }
    ];

    function updateUI() {
      document.getElementById('counter').textContent = count;
      document.getElementById('best').textContent = best;
      document.getElementById('stat-total').textContent = count;
      document.getElementById('stat-best').textContent = best;

      level = 1;
      for (let i = 0; i < thresholds.length; i++) {
        if (count >= thresholds[i]) level = i + 2;
      }

      document.getElementById('level').textContent = level;
      document.getElementById('achieve-level').textContent = level;

      const next = thresholds[level - 1] || 10000;
      const prev = thresholds[level - 2] || 0;
      document.getElementById('progress').max = next - prev;
      document.getElementById('progress').value = count - prev;
    }

    function tap() {
      count++;
      if (count > best) best = count;
      localStorage.setItem('count', count);
      localStorage.setItem('best', best);
      updateUI();
      saveToServer();
    }

    function renderTasks() {
      const list = document.getElementById('task-list');
      list.innerHTML = '';
      tasks.forEach(t => {
        const done = localStorage.getItem(`task_${t.id}`) === 'done';
        const li = document.createElement('li');
        li.className = 'task-card';
        li.innerHTML = `
          <strong>${t.text}</strong><br>
          üéÅ ${t.reward} —Ç–∞–ø–æ–≤<br>
          ${done ? '<span class="done">‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ</span>' :
          `<button onclick="completeTask('${t.id}', ${t.reward}, '${t.link || ''}')">–í—ã–ø–æ–ª–Ω–∏—Ç—å</button>`}
        `;
        list.appendChild(li);
      });
    }

    function completeTask(id, reward, link = '') {
      if (link) window.open(link, '_blank');
      count += reward;
      if (count > best) best = count;
      localStorage.setItem('count', count);
      localStorage.setItem('best', best);
      localStorage.setItem(`task_${id}`, 'done');
      updateUI();
      renderTasks();
      saveToServer();
    }

    function showTab(id) {
      document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    function getFriends() {
      return JSON.parse(localStorage.getItem('friends') || '[]');
    }

    function saveFriends(friends) {
      localStorage.setItem('friends', JSON.stringify(friends));
      document.getElementById('achieve-friends').textContent = friends.length;
    }

    function renderFriends() {
      const tbody = document.getElementById('friends-table');
      const friends = getFriends();
      saveFriends(friends);
      tbody.innerHTML = '';
      friends.forEach((f, i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${i+1}</td><td>${f.name}</td><td>${f.taps}</td>`;
        tbody.appendChild(tr);
      });
    }

    function addFriend(e) {
      e.preventDefault();
      const name = document.getElementById('friend-name').value.trim();
      const taps = parseInt(document.getElementById('friend-taps').value);
      if (!name || isNaN(taps)) return;
      const list = getFriends();
      list.push({ name, taps });
      saveFriends(list);
      renderFriends();
      document.getElementById('friend-name').value = '';
      document.getElementById('friend-taps').value = '';
      saveToServer();
    }

    function saveToServer() {
      fetch('https://your-server.com/api.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          user: tg.initDataUnsafe?.user?.id || 'anon',
          count,
          best,
          level,
          friends: getFriends()
        })
      });
    }

    updateUI();
    renderTasks();
    renderFriends();
  </script>
</body>
</html>
